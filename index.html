<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="title" property="og:title" content="ë£°ë ›ëŒë¦¬ê¸°" />
    <meta name="description" property="og:description" content="ê°€ì¤‘ì¹˜ì ìš©+ì—‘ì…€ë¶™ì´ê¸° ê°€ëŠ¥ ë£°ë ›" />
    <meta name="image" property="og:image" content="./logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="style.css" rel="stylesheet">
    <script>
        var rouletteData;

        function insertAfter(referenceNode, newNode) {
            const parent = (!referenceNode.parentNode) ? document.getElementById('box') : referenceNode.parentNode;
            parent.insertBefore(newNode, referenceNode.nextSibling);
        }
        const add_textbox = (obj, item, weight, index) => {
            const newLi = document.createElement('li');
            const li = (obj.id == "box") ? newLi : obj.parentNode;
            if (!item) { item = "" }
            if (!weight) { weight = "" }
            newLi.innerHTML = "<input type='text' placeholder='ì´ë¦„' class='item' value=" + item + "> <input type='text' placeholder='ê°€ì¤‘ì¹˜' class='weight' value=" + weight + "> <input type='button' value='ì¶”ê°€' onclick='add_textbox(this)'>";
            if (index != 0) { newLi.innerHTML += "<input type='button' value='ì‚­ì œ' onclick='remove(this)'>" }
            insertAfter(li, newLi);
        }
        const remove = (obj) => {
            document.getElementById('box').removeChild(obj.parentNode);
        }

        //edit roulette data
        const editData = () => {
            modalOpen();
            const box = document.getElementById('box');
            while (box.firstChild) {
                box.firstChild.remove()
            }
            for (let i = 0; i < rouletteData.items.length; i++) {
                add_textbox(box, rouletteData.items[i], rouletteData.weights[i], i);
            }
        }

        //apply roulette data
        const setData = () => {
            const liList = document.getElementById('box').childNodes;
            rouletteData.items = [];
            rouletteData.weights = [];
            for (let i = 0; i < liList.length; i++) {
                rouletteData.items[i] = liList[i].children[0].value;
                rouletteData.weights[i] = parseInt(liList[i].children[1].value);
            }
            //console.log(rouletteData.items);
            //console.log(rouletteData.weights);
            localStorage.setItem('rouletteData', JSON.stringify(rouletteData));
            init();
            drawRouletteWheel();
            modalClose();
        }

        const closeData = () => {
            modalClose();
        }

        var isModalOpen = false;
        function modalOpen() {
            document.getElementById('container').classList.add("modal-open");
            isModalOpen = true;
        }
        function modalClose() {
            document.getElementById('container').classList.remove("modal-open");
            isModalOpen = false;
        }

        const pasteClip = (e) => {
            const clipText = e.clipboardData.getData('text/plain');
            var execute = false;
            if (clipText) { execute = confirm("í´ë¦½ë³´ë“œ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?") }
            if (!execute) { return; }

            clipRows = clipText.split("\r\n");


            console.log(clipRows);
            console.log(clipText);
            while (box.firstChild) {
                box.firstChild.remove()
            }
            for (let i = 0; i < clipRows.length; i++) {
                arrThisRow = clipRows[i].split("\t")
                add_textbox(box, arrThisRow[0], arrThisRow[1], i);
            }
        }
    </script>
</head>

<body style="background-color: aquamarine;">
    <!-- <header>ì¬ë¯¸ë¡œ í•´ë³´ëŠ” ë£°ë ›!</header> -->
    <article>
        <section>
            <div class="header">ë£°ë ›íŒ ëŒë¦¬ê¸°</div>
            <div>
                <canvas id="canvas" width="500" height="500"></canvas>
            </div>
            <div class="btn">
                <a href="#" class="btn-3d cyan" id='spin'>ëŒë¦¬ê³ ~ ë„ì˜¬ë¦¬ì´ê³ ~!</a>
                <a href="#" class="btn-3d cyan" id='editData'>ë£°ë ›íŒ ìˆ˜ì •</a>
                <!-- <a href="#" class="btn-3d cyan" id='viewResult'>ê²°ê³¼ë³´ê¸°</a> -->
            </div>
        </section>
        <aside>
        </aside>
    </article>
    <footer></footer>
    <div id="container">
        <div id="modal" class="modal">
            <div class="header">ë£°ë ›íŒ ìˆ˜ì •</div>
            <div class="body">
                <div id="box"></div>
                <div class="info">
                    í˜ì´ì§€ ë¹ˆ ê³³ì„ í´ë¦­í•˜ê³  ì´ë¦„ ê°€ì¤‘ì¹˜ë¡œ ë˜ì–´ ìˆëŠ” ì—‘ì…€ í‘œë¥¼ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!ğŸ˜€
                </div>
                <div class="btn">
                    <a href="#" class="btn-3d cyan" id='setData'>ì ìš©</a>
                    <a href="#" class="btn-3d cyan" id='cancel'>ì·¨ì†Œ</a>
                </div>

            </div>
        </div>
    </div>
    <script type="text/javascript" src="roulette_canvas.js"></script>
    <script>
        document.getElementById("editData").addEventListener("click", editData);
        document.getElementById("setData").addEventListener("click", setData);
        document.getElementById("cancel").addEventListener("click", closeData);
        document.getElementById("modal").addEventListener("paste", pasteClip);
    </script>
</body>

</html>